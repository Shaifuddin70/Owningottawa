<?php include 'components/header.php'; ?>
<main class="main-content modern-redesign">

    <!-- Hero Section -->
    <!-- <section class="modern-hero" aria-label="Resources">
        <div class="hero-media">
            <img src="https://via.placeholder.com/1920x600/1a1a1a/d3ae77?text=Resources" alt="Resources Background">
        </div>
        <div class="modern-hero-content">
            <div class="hero-badge fade-in-up">
                <i class="fas fa-book"></i>
                <span>Helpful Resources</span>
            </div>
            <h1 class="modern-hero-title fade-in-up delay-1">Your Real Estate Resource Hub</h1>
            <p class="modern-hero-subtitle fade-in-up delay-2">Access guides, tools, and insights to help you make informed property decisions in Ottawa.</p>
            <div class="hero-cta-buttons fade-in-up delay-3">
                <a href="/contact" class="btn-modern-primary">
                    <span>Book Appointment</span>
                    <i class="fas fa-calendar-check"></i>
                </a>
            </div>
        </div>
    </section> -->

    <!-- Resources Overview -->
    <section class="resources-overview">
        <div class="container">
            <div class="section-header text-center scroll-animate">
                <span class="section-tag"><i class="fas fa-lightbulb"></i> Resources</span>
                <h2 class="section-title-modern">Everything You Need to Know</h2>
                <p class="section-subtitle-modern">From first-time buyer guides to market insights, find the information you need to navigate Ottawa's real estate market with confidence.</p>
            </div>

            <div class="hero-cta-buttons fade-in-up delay-3">
                <a href="/contact" class="btn-modern-primary">
                    <span>Book Appointment</span>
                    <i class="fas fa-calendar-check"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Guides Section -->
    <section class="resources-guides">
        <div class="container">
            <div class="section-header scroll-animate">
                <span class="section-tag"><i class="fas fa-file-alt"></i> Guides</span>
                <h2 class="section-title-modern">Step-by-Step Guides</h2>
                <p class="section-description">Comprehensive guides to help you through every stage of your property journey.</p>
            </div>

            <div class="resources-grid">
                <div class="resource-card scroll-animate">
                    <div class="resource-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="resource-title">First-Time Home Buyer Guide</h3>
                    <p class="resource-description">Everything you need to know about buying your first home in Ottawa, from pre-approval to closing day.</p>
                    <a href="/files/OwningOttawa-Group-Buyers-Guide.pdf" class="resource-link" target="_blank" rel="noopener">
                        <span>Get the Guide</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="resource-card scroll-animate delay-1">
                    <div class="resource-icon">
                        <i class="fas fa-hand-holding-usd"></i>
                    </div>
                    <h3 class="resource-title">Selling Your Home Guide</h3>
                    <p class="resource-description">Learn how to prepare, price, and market your property for a successful sale in Ottawa's competitive market.</p>
                    <a href="/files/Sellers-Guide-OwningOttawaGroup.pdf" class="resource-link" target="_blank" rel="noopener">
                        <span>Get the Guide</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="resource-card scroll-animate delay-2">
                    <div class="resource-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="resource-title">Investment Property Guide</h3>
                    <p class="resource-description">Strategies and insights for building a profitable real estate portfolio in Ottawa's growing market.</p>
                    <a href="/files/InvestorsGuide-OwningOttawaGroup.pdf" class="resource-link" target="_blank" rel="noopener">
                        <span>Get the Guide</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="resource-card scroll-animate delay-3">
                    <div class="resource-icon">
                        <i class="fas fa-truck-moving"></i>
                    </div>
                    <h3 class="resource-title">Relocation Guide</h3>
                    <p class="resource-description">Everything you need for a smooth move to Ottawa, including tips for relocating and settling into your new home.</p>
                    <a href="/files/RelocationGuide-Owning-Ottawa-Group.pdf" class="resource-link" target="_blank" rel="noopener">
                        <span>Get the Guide</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Tools & Calculators Section -->
    <!-- <section class="resources-tools">
        <div class="container">
            <div class="section-header scroll-animate">
                <span class="section-tag"><i class="fas fa-calculator"></i> Tools</span>
                <h2 class="section-title-modern">Helpful Calculators & Tools</h2>
                <p class="section-description">Use our tools to estimate costs, payments, and make informed financial decisions.</p>
            </div>

            <div class="tools-grid">
                <div class="tool-card scroll-animate">
                    <div class="tool-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h3 class="tool-title">Mortgage Calculator</h3>
                    <p class="tool-description">Calculate your monthly mortgage payments based on loan amount, interest rate, and term.</p>
                    <a href="/contact" class="btn-modern-outline">
                        <span>Use Calculator</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="tool-card scroll-animate delay-1">
                    <div class="tool-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3 class="tool-title">Affordability Calculator</h3>
                    <p class="tool-description">Determine how much home you can afford based on your income, expenses, and down payment.</p>
                    <a href="/contact" class="btn-modern-outline">
                        <span>Use Calculator</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="tool-card scroll-animate delay-2">
                    <div class="tool-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="tool-title">Rent vs Buy Calculator</h3>
                    <p class="tool-description">Compare the costs of renting versus buying to make the best decision for your situation.</p>
                    <a href="/contact" class="btn-modern-outline">
                        <span>Use Calculator</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section> -->

    <!-- Downloadable Excel Calculators Section -->
    <section class="resources-downloads">
        <div class="container">
            <div class="section-header scroll-animate">
                <span class="section-tag"><i class="fas fa-file-excel"></i> Downloadable Calculators</span>
                <h2 class="section-title-modern">Excel Investment Calculators</h2>
                <p class="section-description">Download our professional Excel calculators to analyze investment properties, calculate returns, and track cash flow.</p>
            </div>

            <div class="downloads-grid">
                <div class="download-card scroll-animate">
                    <div class="download-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <h3 class="download-title">Investment Property Closing & Holding Costs</h3>
                    <p class="download-description">Calculate all closing costs and ongoing holding expenses for your investment property purchase.</p>
                    <a href="/calculators/Investment-Property-Closing-and-Holding-Costs.xlsx" class="download-link" data-download-file="Investment-Property-Closing-and-Holding-Costs.xlsx" data-download-name="Investment Property Closing & Holding Costs">
                        <i class="fas fa-download"></i>
                        <span>Download Excel File</span>
                    </a>
                </div>

                <div class="download-card scroll-animate delay-1">
                    <div class="download-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <h3 class="download-title">Investment Property ROI Calculator</h3>
                    <p class="download-description">Analyze return on investment, cash-on-cash returns, and overall profitability of investment properties.</p>
                    <a href="/calculators/Investment-Property-ROI-Calculator.xlsx" class="download-link" data-download-file="Investment-Property-ROI-Calculator.xlsx" data-download-name="Investment Property ROI Calculator">
                        <i class="fas fa-download"></i>
                        <span>Download Excel File</span>
                    </a>
                </div>

                <div class="download-card scroll-animate delay-2">
                    <div class="download-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    <h3 class="download-title">Property Cash Flow Analyzer</h3>
                    <p class="download-description">Comprehensive cash flow analysis tool to track income, expenses, and net cash flow for your investment properties.</p>
                    <a href="/calculators/Property-Cash-Flow-Analyzer.xlsx" class="download-link" data-download-file="Property-Cash-Flow-Analyzer.xlsx" data-download-name="Property Cash Flow Analyzer">
                        <i class="fas fa-download"></i>
                        <span>Download Excel File</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Market Insights Section -->
    <!-- <section class="resources-insights">
        <div class="container">
            <div class="insights-grid">
                <div class="insights-content scroll-animate">
                    <span class="section-tag"><i class="fas fa-chart-bar"></i> Market Insights</span>
                    <h2 class="section-title-modern">Ottawa Real Estate Market Insights</h2>
                    <p class="section-description">Stay informed about Ottawa's real estate market trends, neighborhood highlights, and investment opportunities.</p>
                    
                    <div class="insights-features">
                        <div class="insight-feature">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <h4>Market Reports</h4>
                                <p>Quarterly market analysis and trends</p>
                            </div>
                        </div>
                        <div class="insight-feature">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <h4>Neighborhood Guides</h4>
                                <p>Detailed information about Ottawa neighborhoods</p>
                            </div>
                        </div>
                        <div class="insight-feature">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <h4>Price Trends</h4>
                                <p>Historical data and future projections</p>
                            </div>
                        </div>
                    </div>

                    <a href="/contact" class="btn-modern-primary">
                        <span>Request Market Report</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>

                <div class="insights-image scroll-animate delay-1">
                    <img src="https://via.placeholder.com/700x600/1a1a1a/d3ae77?text=Market+Insights" alt="Ottawa Market Insights">
                    <div class="image-decoration"></div>
                </div>
            </div>
        </div>
    </section> -->

    <!-- Helpful Links Section -->
    <!-- <section class="resources-links">
        <div class="container">
            <div class="section-header text-center scroll-animate">
                <span class="section-tag"><i class="fas fa-link"></i> Quick Links</span>
                <h2 class="section-title-modern">Useful Resources & Links</h2>
                <p class="section-subtitle-modern">Access helpful websites and resources for your real estate journey</p>
            </div>

            <div class="links-grid">
                <div class="link-category scroll-animate">
                    <h3 class="link-category-title">
                        <i class="fas fa-university"></i>
                        Government Resources
                    </h3>
                    <ul class="link-list">
                        <li><a href="https://www.cmhc-schl.gc.ca" target="_blank" rel="noopener">CMHC - Canada Mortgage and Housing Corporation</a></li>
                        <li><a href="https://www.canada.ca/en/services/taxes.html" target="_blank" rel="noopener">Canada Revenue Agency - Tax Information</a></li>
                        <li><a href="https://www.ottawa.ca" target="_blank" rel="noopener">City of Ottawa</a></li>
                        <li><a href="https://www.ontario.ca/page/land-registry" target="_blank" rel="noopener">Ontario Land Registry</a></li>
                    </ul>
                </div>

                <div class="link-category scroll-animate delay-1">
                    <h3 class="link-category-title">
                        <i class="fas fa-building"></i>
                        Real Estate Organizations
                    </h3>
                    <ul class="link-list">
                        <li><a href="https://www.orea.com" target="_blank" rel="noopener">OREA - Ontario Real Estate Association</a></li>
                        <li><a href="https://www.crea.ca" target="_blank" rel="noopener">CREA - Canadian Real Estate Association</a></li>
                        <li><a href="https://www.ottawarealtors.org" target="_blank" rel="noopener">Ottawa Real Estate Board</a></li>
                    </ul>
                </div>

                <div class="link-category scroll-animate delay-2">
                    <h3 class="link-category-title">
                        <i class="fas fa-tools"></i>
                        Home Improvement
                    </h3>
                    <ul class="link-list">
                        <li><a href="https://www.ottawa.ca/en/building-and-development" target="_blank" rel="noopener">Ottawa Building Permits</a></li>
                        <li><a href="https://www.ontario.ca/page/home-energy-audits" target="_blank" rel="noopener">Home Energy Audits</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section> -->

    <!-- FAQ Section -->
    <section class="faq-modern">
        <div class="container">
            <div class="section-header text-center scroll-animate">
                <span class="section-tag"><i class="fas fa-question-circle"></i> FAQ</span>
                <h2 class="section-title-modern">Frequently Asked Questions</h2>
                <p class="section-subtitle-modern">Common questions about resources and tools</p>
            </div>

            <div class="faq-grid">
                <div class="faq-column">
                    <div class="faq-item-modern scroll-animate">
                        <button class="faq-question-modern" type="button" onclick="toggleModernFAQ(this)">
                            <span class="faq-icon"><i class="fas fa-file-alt"></i></span>
                            <span class="faq-title">How do I access the guides?</span>
                            <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Contact us through our contact form or call us directly, and we'll provide you with the guides you need. We can also discuss your specific situation and customize the information for you.</p>
                        </div>
                    </div>

                    <div class="faq-item-modern scroll-animate delay-1">
                        <button class="faq-question-modern" type="button" onclick="toggleModernFAQ(this)">
                            <span class="faq-icon"><i class="fas fa-calculator"></i></span>
                            <span class="faq-title">Are the calculators free to use?</span>
                            <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Yes, all our calculators and tools are free to use. Contact us to access them, and we can also provide personalized calculations based on your specific situation.</p>
                        </div>
                    </div>
                </div>

                <div class="faq-column">
                    <div class="faq-item-modern scroll-animate delay-2">
                        <button class="faq-question-modern" type="button" onclick="toggleModernFAQ(this)">
                            <span class="faq-icon"><i class="fas fa-chart-bar"></i></span>
                            <span class="faq-title">How often are market reports updated?</span>
                            <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                        </button>
                        <div class="faq-answer-modern">
                            <p>We provide quarterly market reports and can also offer customized market analysis for specific neighborhoods or property types upon request.</p>
                        </div>
                    </div>

                    <div class="faq-item-modern scroll-animate delay-3">
                        <button class="faq-question-modern" type="button" onclick="toggleModernFAQ(this)">
                            <span class="faq-icon"><i class="fas fa-book"></i></span>
                            <span class="faq-title">Can I get personalized advice?</span>
                            <span class="faq-toggle"><i class="fas fa-plus"></i></span>
                        </button>
                        <div class="faq-answer-modern">
                            <p>Absolutely! While our resources provide general information, we offer personalized consultations to address your specific needs and goals. Book a consultation to get started.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-content scroll-animate">
                <div class="cta-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h2 class="cta-title">Need More Information?</h2>
                <p class="cta-text">Our team is here to help you access the resources you need and answer any questions about Ottawa's real estate market.</p>
                <div class="cta-buttons">
                    <a href="/contact" class="btn-modern-primary">
                        <span>Contact Us</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="tel:6133328884" class="btn-modern-outline">
                        <span><i class="fas fa-phone"></i> Call Now</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Download Form Modal -->
    <div class="download-modal" id="downloadModal">
        <div class="download-modal-overlay"></div>
        <div class="download-modal-container">
            <div class="download-modal-header">
                <h3 class="download-modal-title">
                    <i class="fas fa-file-excel"></i>
                    <span id="downloadModalFileName">Download Calculator</span>
                </h3>
                <button class="download-modal-close" id="downloadModalClose" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="download-modal-body">
                <p class="download-modal-description">Please provide your information to download this calculator. We'll send you updates and helpful resources.</p>
                <form class="contact-form download-form" id="downloadForm" method="POST" action="https://formspree.io/f/meejqovw">
                    <input type="hidden" name="calculator_name" id="calculatorName" value="">
                    <input type="hidden" name="calculator_file" id="calculatorFile" value="">
                    <input type="hidden" name="form_type" value="calculator_download">

                    <div class="form-group">
                        <label for="downloadName" class="form-label">
                            <i class="fas fa-user"></i>
                            <span>Full Name</span>
                        </label>
                        <input type="text" id="downloadName" name="name" class="form-input" placeholder="Enter your full name" required>
                    </div>

                    <div class="form-group">
                        <label for="downloadEmail" class="form-label">
                            <i class="fas fa-envelope"></i>
                            <span>Email Address</span>
                        </label>
                        <input type="email" id="downloadEmail" name="email" class="form-input" placeholder="Enter your email address" required>
                    </div>

                    <div class="form-group">
                        <label for="downloadPhone" class="form-label">
                            <i class="fas fa-phone"></i>
                            <span>Phone Number</span>
                        </label>
                        <input type="tel" id="downloadPhone" name="phone" class="form-input" placeholder="Enter your phone number" required>
                    </div>

                    <div class="form-group">
                        <label for="downloadService" class="form-label">
                            <i class="fas fa-briefcase"></i>
                            <span>Service Interested In</span>
                        </label>
                        <select id="downloadService" name="service" class="form-select" required>
                            <option value="">Select a service</option>
                            <option value="real-estate">Real Estate</option>
                            <option value="mortgage">Mortgage Solutions</option>
                            <option value="property-management">Property Management</option>
                            <option value="bookkeeping">Bookkeeping & Accounting</option>
                            <option value="permits">Building Permits & Design</option>
                            <option value="general">General Inquiry</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="downloadMessage" class="form-label">
                            <i class="fas fa-comment-alt"></i>
                            <span>Message</span>
                        </label>
                        <textarea id="downloadMessage" name="message" class="form-textarea" rows="5" placeholder="Tell us about your needs..." required></textarea>
                    </div>

                    <div class="form-message hidden" id="downloadFormMessage"></div>

                    <div class="download-modal-actions">
                        <button type="submit" class="btn-modern-primary form-submit download-submit-btn" id="downloadSubmitBtn">
                            <span>Submit & Download</span>
                            <i class="fas fa-download"></i>
                        </button>
                        <button type="button" class="btn-modern-outline download-cancel-btn" id="downloadCancelBtn">
                            <span>Cancel</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</main>

<script>
    // Modern FAQ Toggle
    function toggleModernFAQ(button) {
        const item = button.parentElement;
        const answer = item.querySelector('.faq-answer-modern');
        const icon = button.querySelector('.faq-toggle i');
        const isOpen = item.classList.contains('active');

        // Close all other FAQs
        document.querySelectorAll('.faq-item-modern').forEach(faq => {
            if (faq !== item) {
                faq.classList.remove('active');
                faq.querySelector('.faq-answer-modern').style.maxHeight = null;
                faq.querySelector('.faq-toggle i').classList.remove('fa-minus');
                faq.querySelector('.faq-toggle i').classList.add('fa-plus');
            }
        });

        // Toggle current FAQ
        if (isOpen) {
            item.classList.remove('active');
            answer.style.maxHeight = null;
            icon.classList.remove('fa-minus');
            icon.classList.add('fa-plus');
        } else {
            item.classList.add('active');
            answer.style.maxHeight = answer.scrollHeight + 'px';
            icon.classList.remove('fa-plus');
            icon.classList.add('fa-minus');
        }
    }

    // Scroll animations
    // Check if observerOptions already exists (from footer.php)
    if (typeof observerOptions === 'undefined') {
        var observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
    }

    // Use a unique name to avoid conflicts
    var resourcesObserver;
    if (!resourcesObserver) {
        resourcesObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animated');
                }
            });
        }, observerOptions);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const animatedElements = document.querySelectorAll('.scroll-animate');
        animatedElements.forEach(el => {
            if (resourcesObserver) {
                resourcesObserver.observe(el);
            }
        });
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Download Modal Functionality
    document.addEventListener('DOMContentLoaded', () => {
        const downloadModal = document.getElementById('downloadModal');
        const downloadModalClose = document.getElementById('downloadModalClose');
        const downloadCancelBtn = document.getElementById('downloadCancelBtn');
        const downloadLinks = document.querySelectorAll('.download-link');
        const downloadForm = document.getElementById('downloadForm');
        const downloadFormMessage = document.getElementById('downloadFormMessage');
        const downloadSubmitBtn = document.getElementById('downloadSubmitBtn');
        const calculatorNameInput = document.getElementById('calculatorName');
        const calculatorFileInput = document.getElementById('calculatorFile');
        const downloadModalFileName = document.getElementById('downloadModalFileName');

        let currentDownloadUrl = '';
        let currentDownloadFile = '';

        // Open modal when download link is clicked
        downloadLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // Get download information
                const downloadUrl = this.getAttribute('href');
                const downloadFile = this.getAttribute('data-download-file') || downloadUrl.split('/').pop();
                const downloadName = this.getAttribute('data-download-name') || downloadFile.replace(/\.(xlsx|XLSX)$/, '').replace(/[-+]/g, ' ');

                // Store for later use
                currentDownloadUrl = downloadUrl;
                currentDownloadFile = downloadFile;

                // Set form values
                calculatorNameInput.value = downloadName;
                calculatorFileInput.value = downloadFile;
                downloadModalFileName.textContent = downloadName;

                // Reset form
                downloadForm.reset();
                calculatorNameInput.value = downloadName;
                calculatorFileInput.value = downloadFile;
                downloadFormMessage.textContent = '';
                downloadFormMessage.className = 'form-message';

                // Ensure page loader stays hidden
                const pageLoader = document.getElementById('pageLoader');
                if (pageLoader) {
                    pageLoader.style.display = 'none';
                    pageLoader.classList.add('hidden');
                }

                // Show modal
                // Prevent body scroll
                const scrollY = window.scrollY;
                document.body.style.position = 'fixed';
                document.body.style.top = `-${scrollY}px`;
                document.body.style.width = '100%';
                document.body.style.overflow = 'hidden';
                document.body.classList.add('modal-open');

                // Show modal
                downloadModal.classList.add('active');

                // Store scroll position for restoration
                downloadModal.dataset.scrollY = scrollY;
            });
        });

        // Close modal
        function closeDownloadModal() {
            if (!downloadModal.classList.contains('active')) {
                return; // Already closed
            }

            downloadModal.classList.remove('active');

            // Ensure page loader stays hidden
            const pageLoader = document.getElementById('pageLoader');
            if (pageLoader) {
                pageLoader.style.display = 'none';
                pageLoader.classList.add('hidden');
            }

            // Reset body styles and restore scroll position
            const scrollY = downloadModal.dataset.scrollY || 0;
            setTimeout(() => {
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                document.body.style.height = '';
                document.body.classList.remove('modal-open');

                // Restore scroll position without triggering events
                if (scrollY) {
                    // Use requestAnimationFrame to ensure smooth restoration
                    requestAnimationFrame(() => {
                        window.scrollTo({
                            top: parseInt(scrollY, 10),
                            behavior: 'auto' // Instant scroll, no animation
                        });

                        // Ensure loader stays hidden after scroll
                        if (pageLoader) {
                            pageLoader.style.display = 'none';
                            pageLoader.classList.add('hidden');
                        }
                    });
                } else {
                    // Ensure loader stays hidden even if no scroll restoration
                    if (pageLoader) {
                        pageLoader.style.display = 'none';
                        pageLoader.classList.add('hidden');
                    }
                }
            }, 300);

            downloadForm.reset();
            downloadFormMessage.textContent = '';
            downloadFormMessage.className = 'form-message hidden';
            currentDownloadUrl = '';
            currentDownloadFile = '';
        }

        downloadModalClose.addEventListener('click', closeDownloadModal);
        downloadCancelBtn.addEventListener('click', closeDownloadModal);

        // Close on overlay click
        downloadModal.addEventListener('click', function(e) {
            // Only close if clicking directly on overlay or modal background, not on container
            if (e.target === downloadModal || e.target.classList.contains('download-modal-overlay')) {
                closeDownloadModal();
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && downloadModal.classList.contains('active')) {
                closeDownloadModal();
            }
        });

        // Real-time validation (same as contact form)
        function setupFieldValidation() {
            const inputs = downloadForm.querySelectorAll('.form-input, .form-select, .form-textarea');

            inputs.forEach(input => {
                // Remove validation on input
                input.addEventListener('input', function() {
                    if (this.classList.contains('error')) {
                        this.classList.remove('error');
                    }
                });

                // Validate on blur
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            });
        }

        function validateField(field) {
            const value = field.value.trim();
            let isValid = true;
            let errorMessage = '';

            // Remove existing error class
            field.classList.remove('error');

            // Remove any existing error message
            const existingError = field.parentElement.querySelector('.field-error');
            if (existingError) {
                existingError.remove();
            }

            // Validate based on field type
            if (field.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'This field is required.';
            } else if (field.type === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid email address.';
                }
            } else if (field.type === 'tel' && value) {
                const phoneRegex = /^[\d\s\-\+\(\)]+$/;
                const phoneDigits = value.replace(/\D/g, '');
                if (!phoneRegex.test(value) || phoneDigits.length < 10) {
                    isValid = false;
                    errorMessage = 'Please enter a valid phone number (at least 10 digits).';
                }
            } else if (field.tagName === 'TEXTAREA' && value && value.length < 10) {
                isValid = false;
                errorMessage = 'Message must be at least 10 characters.';
            }

            // Show error if invalid
            if (!isValid) {
                field.classList.add('error');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${errorMessage}`;
                field.parentElement.appendChild(errorDiv);
            }

            return isValid;
        }

        // Setup validation
        if (downloadForm) {
            setupFieldValidation();

            // Handle form submission
            downloadForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                // Get form values
                const name = document.getElementById('downloadName').value.trim();
                const email = document.getElementById('downloadEmail').value.trim();
                const phone = document.getElementById('downloadPhone').value.trim();
                const service = document.getElementById('downloadService').value;
                const message = document.getElementById('downloadMessage').value.trim();

                // Reset message
                downloadFormMessage.textContent = '';
                downloadFormMessage.className = 'form-message hidden';

                // Validate all fields
                const fields = [{
                        element: document.getElementById('downloadName'),
                        value: name
                    },
                    {
                        element: document.getElementById('downloadEmail'),
                        value: email
                    },
                    {
                        element: document.getElementById('downloadPhone'),
                        value: phone
                    },
                    {
                        element: document.getElementById('downloadService'),
                        value: service
                    },
                    {
                        element: document.getElementById('downloadMessage'),
                        value: message
                    }
                ];

                let allValid = true;
                fields.forEach(field => {
                    if (!validateField(field.element)) {
                        allValid = false;
                    }
                });

                if (!allValid) {
                    downloadFormMessage.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please fix the errors above and try again.';
                    downloadFormMessage.classList.remove('hidden');
                    downloadFormMessage.classList.add('error');

                    // Scroll to first error
                    const firstError = downloadForm.querySelector('.error');
                    if (firstError) {
                        firstError.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                        firstError.focus();
                    }
                    return;
                }

                // Show loading state
                downloadSubmitBtn.classList.add('loading');
                downloadSubmitBtn.disabled = true;
                downloadSubmitBtn.innerHTML = '<span>Submitting...</span><i class="fas fa-spinner fa-spin"></i>';

                // Get form data
                const formData = new FormData(downloadForm);

                try {
                    // Submit to Formspree
                    const response = await fetch('https://formspree.io/f/meejqovw', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        // Show success message
                        downloadFormMessage.innerHTML = '<i class="fas fa-check-circle"></i> Thank you! Your information has been submitted. Downloading your calculator...';
                        downloadFormMessage.classList.remove('hidden');
                        downloadFormMessage.classList.remove('error');
                        downloadFormMessage.classList.add('success');

                        // Trigger download after a short delay
                        setTimeout(() => {
                            const link = document.createElement('a');
                            link.href = currentDownloadUrl;
                            link.download = currentDownloadFile;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);

                            // Close modal after download starts
                            setTimeout(() => {
                                closeDownloadModal();
                            }, 1000);
                        }, 500);
                    } else {
                        // Handle Formspree errors
                        const data = await response.json();
                        throw new Error(data.error || 'Submission failed');
                    }
                } catch (error) {
                    // Show error message
                    downloadFormMessage.innerHTML = '<i class="fas fa-exclamation-circle"></i> ' + (error.message || 'There was an error submitting your information. Please try again.');
                    downloadFormMessage.classList.remove('hidden');
                    downloadFormMessage.classList.remove('success');
                    downloadFormMessage.classList.add('error');

                    // Remove loading state
                    downloadSubmitBtn.classList.remove('loading');
                    downloadSubmitBtn.disabled = false;
                    downloadSubmitBtn.innerHTML = '<span>Submit & Download</span><i class="fas fa-download"></i>';
                }
            });
        }
    });
</script>

<?php include 'components/footer.php'; ?>